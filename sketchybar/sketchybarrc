#!/usr/bin/env bash
# Source: github.com/Kcraft059/sketchybar-config (minimal aerospace config)

export PATH="/opt/homebrew/bin:/opt/homebrew/sbin:/run/current-system/sw/bin:$HOME/.local/bin:$HOME/.nix-profile/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:$PATH"

RELPATH="$HOME/.config/sketchybar"

source "$RELPATH/colors.sh"
source "$RELPATH/log_handler.sh"
source "$RELPATH/add_separator.sh"
source "$RELPATH/plugins/icon_map.sh"

FONT="SF Pro"
BAR_HEIGHT=34
BAR_MARGIN=5
BAR_CORNER_RADIUS=13
ZONE_CORNER_RADIUS=$((BAR_CORNER_RADIUS - 5))
OUTER_PADDINGS=5
INNER_PADDINGS=5

bar=(
    height=$BAR_HEIGHT
    y_offset=$BAR_MARGIN
    margin=$BAR_MARGIN
    topmost=window
    sticky=on
    position=top
    padding_left=10
    padding_right=10
    color="$BAR_COLOR"
    border_width=1
    border_color=$BORDER_COLOR
    corner_radius=$BAR_CORNER_RADIUS
    blur_radius=14
)

defaults=(
    updates=when_shown
    icon.font="$FONT:Regular:14.0"
    icon.color=$ICON_COLOR
    padding_left=$OUTER_PADDINGS
    padding_right=$OUTER_PADDINGS
    icon.padding_left=$INNER_PADDINGS
    icon.padding_right=$INNER_PADDINGS
    label.font="$FONT:Semibold:13.0"
    label.color=$LABEL_COLOR
    label.padding_left=$INNER_PADDINGS
    label.padding_right=$INNER_PADDINGS
    background.corner_radius=$ZONE_CORNER_RADIUS
    popup.y_offset=4
    popup.background.border_width=1
    popup.background.corner_radius=6
    popup.background.border_color=$POPUP_BORDER_COLOR
    popup.background.color=$POPUP_BACKGROUND_COLOR
    popup.blur_radius=20
)

zones=(
    background.height=$((BAR_HEIGHT - 8))
    background.border_width=2
    background.border_color=$HIGH_MED
    background.color=$OVERLAY
    background.corner_radius=$ZONE_CORNER_RADIUS
)

sketchybar --bar "${bar[@]}"
sketchybar --default "${defaults[@]}"

source "$RELPATH/items/spaces.sh"
source "$RELPATH/items/calendar.sh"
source "$RELPATH/items/wifi.sh"
source "$RELPATH/items/bluetooth.sh"

sketchybar --add bracket base-controls wifi \
    --set base-controls "${zones[@]}"

sketchybar --update

echo "sketchybar configuration loaded"
