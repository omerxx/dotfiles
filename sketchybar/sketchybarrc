#!/usr/bin/env bash
# Source: github.com/Kcraft059/sketchybar-config

export PATH="/opt/homebrew/bin:/opt/homebrew/sbin:/run/current-system/sw/bin:$HOME/.local/bin:$HOME/.nix-profile/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:$PATH"

RELPATH="$HOME/.config/sketchybar"
source "$RELPATH/plugins/icon_map.sh"

FONT="SF Pro"

BAR_COLOR=0xee1e1e2e
ACCENT=0xffcba6f7
TEXT=0xffcdd6f4
SUBTLE=0xff6c7086
SURFACE=0xff313244
HIGHLIGHT=0xfff38ba8
ACTIVE_BG=0xff45475a

sketchybar --bar height=40 \
                 y_offset=6 \
                 margin=8 \
                 position=top \
                 sticky=on \
                 padding_left=12 \
                 padding_right=12 \
                 color=$BAR_COLOR \
                 corner_radius=12 \
                 blur_radius=30 \
                 shadow=on

sketchybar --default updates=when_shown \
                     icon.font="$FONT:Bold:14.0" \
                     icon.color=$TEXT \
                     label.font="$FONT:Semibold:13.0" \
                     label.color=$TEXT \
                     padding_left=4 \
                     padding_right=4 \
                     icon.padding_left=8 \
                     icon.padding_right=6 \
                     label.padding_left=6 \
                     label.padding_right=8 \
                     background.height=28 \
                     background.corner_radius=8

sketchybar --add event aerospace_workspace_change

for sid in $(aerospace list-workspaces --all 2>/dev/null); do
    sketchybar --add item space.$sid left \
        --subscribe space.$sid aerospace_workspace_change mouse.clicked \
        --set space.$sid \
            icon="$sid" \
            icon.font="$FONT:Bold:13.0" \
            icon.color=$SUBTLE \
            icon.highlight_color=$BAR_COLOR \
            icon.padding_left=10 \
            icon.padding_right=10 \
            background.color=$SURFACE \
            background.corner_radius=6 \
            background.height=24 \
            background.drawing=off \
            label.font="sketchybar-app-font:Regular:14.0" \
            label.color=$TEXT \
            label.padding_right=12 \
            label.drawing=off \
            click_script="aerospace workspace $sid" \
            script="$RELPATH/plugins/spaces/aerospace/script-space.sh $sid"
done

sketchybar --add item separator left \
           --set separator icon=􀆊 \
                          icon.font="$FONT:Bold:16.0" \
                          icon.color=$SUBTLE \
                          icon.padding_left=8 \
                          icon.padding_right=4 \
                          label.drawing=off \
                          background.drawing=off

sketchybar --add item front_app center \
           --set front_app icon.drawing=off \
                          label.font="$FONT:Semibold:13.0" \
                          label.color=$TEXT \
                          background.drawing=off \
                          script="$RELPATH/plugins/front_app/script.sh" \
           --subscribe front_app front_app_switched

sketchybar --add item calendar right \
           --set calendar icon="$(date '+%a %d %b')" \
                         label="$(date '+%H:%M')" \
                         icon.font="$FONT:Semibold:12.0" \
                         icon.color=$ACCENT \
                         label.font="$FONT:Bold:12.0" \
                         background.color=$SURFACE \
                         background.drawing=on \
                         update_freq=30 \
                         click_script="open -a Calendar" \
                         script="$RELPATH/plugins/calendar/script.sh"

sketchybar --add item events right \
           --set events icon=􀉉 \
                       icon.color=$ACCENT \
                       icon.font="$FONT:Bold:14.0" \
                       label.font="$FONT:Regular:11.0" \
                       label.color=$TEXT \
                       label.max_chars=30 \
                       background.color=$SURFACE \
                       background.drawing=on \
                       update_freq=300 \
                       click_script="open -a Calendar" \
                       script="$RELPATH/plugins/calendar/events.sh"

sketchybar --add item wifi right \
           --set wifi icon=􀙇 \
                     icon.color=$ACCENT \
                     label.color=$TEXT \
                     label.font="$FONT:Semibold:11.0" \
                     background.color=$SURFACE \
                     background.drawing=on \
                     script="$RELPATH/plugins/wifi/script.sh" \
           --subscribe wifi wifi_change

sketchybar --add item bluetooth right \
	           --set bluetooth icon=􀪷 \
	                          icon.color=$ACCENT \
	                          label.color=$TEXT \
	                          label.font="$FONT:Semibold:11.0" \
	                          background.color=$SURFACE \
	                          background.drawing=on \
	                          update_freq=30 \
	                          click_script="$RELPATH/plugins/bluetooth/click.sh" \
	                          script="$RELPATH/plugins/bluetooth/script.sh"

if [ -x "/Applications/CMatrixWallpaper.app/Contents/MacOS/matrixdaemon" ]; then
    sketchybar --add item matrix_wallpaper right \
               --set matrix_wallpaper icon="M" \
                                      icon.color=$ACCENT \
                                      label.color=$TEXT \
                                      label.font="$FONT:Semibold:11.0" \
                                      background.color=$SURFACE \
                                      background.drawing=on \
                                      update_freq=30 \
                                      click_script="$RELPATH/plugins/matrix_wallpaper/click.sh" \
                                      script="$RELPATH/plugins/matrix_wallpaper/script.sh"
fi

sketchybar --update

echo "sketchybar configuration loaded"
